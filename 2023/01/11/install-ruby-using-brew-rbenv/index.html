<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Install Ruby Using Brew Rbenv</title>
  <meta name="description" content="First steps on new Ubuntu machine">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://dev.trk.in.rs/2023/01/11/install-ruby-using-brew-rbenv/">
  <link rel="alternate" type="application/rss+xml" title="TRK RAILS" href="https://dev.trk.in.rs/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">
      <img src="/assets/rails_trk.svg" class="header-logo">
      TRK RAILS
    </a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Install Ruby Using Brew Rbenv</h1>
    <p class="post-meta"><time datetime="2023-01-11T00:00:00+00:00" itemprop="datePublished">Jan 11, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#first-steps-on-new-ubuntu-machine">First steps on new Ubuntu machine</a></li>
<li class="toc-entry toc-h2"><a href="#brew">Brew</a></li>
<li class="toc-entry toc-h2"><a href="#install-rbenv">Install rbenv</a></li>
<li class="toc-entry toc-h2"><a href="#installing-ruby-using-rbenv">Installing Ruby using rbenv</a>
<ul>
<li class="toc-entry toc-h3"><a href="#ruby-320">Ruby 3.2.0</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#jekyll">Jekyll</a></li>
<li class="toc-entry toc-h2"><a href="#rails">Rails</a></li>
<li class="toc-entry toc-h2"><a href="#nvm-node-yarn">NVM node yarn</a></li>
<li class="toc-entry toc-h2"><a href="#wall">Wall</a></li>
<li class="toc-entry toc-h2"><a href="#python">Python</a></li>
</ul><h2 id="first-steps-on-new-ubuntu-machine">
<a class="anchor" href="#first-steps-on-new-ubuntu-machine" aria-hidden="true"><span class="octicon octicon-link"></span></a>First steps on new Ubuntu machine</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git is used to code collaboration
sudo apt install -y git curl
# necessary if you want to commit to any project
git config --global user.email "you@example.com"
git config --global user.name "Your Name"
# nice editor
sudo apt install vim
# if you want to change default editor from nano to something else
sudo update-alternatives --config editor
# enable ssh to localhost
sudo apt install openssh-server
# generate ~/ssh/id_rsa and ~/ssh/id_rsa.pub to add to
ssh-keygen

# network tool to find all open ports and ip addresses, eg  nmap -F 192.168.1.-
sudo apt install nmap

# for building ruby
sudo apt install -y build-essential libz-dev
</code></pre></div></div>

<p>Install google chrome from <a href="https://www.google.com/chrome/">https://www.google.com/chrome/</a>
Right click on .deb file in Downloads, select Properties and in ‘Open With’ tab select ‘Software Install’ and click ‘Set as default’. Exit and double click on the .deb file to install Chrome.</p>

<h2 id="brew">
<a class="anchor" href="#brew" aria-hidden="true"><span class="octicon octicon-link"></span></a>Brew</h2>

<p>Use brew instead of manually install packages so all users can use the same libs
<a href="https://brew.sh/">https://brew.sh/</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
</code></pre></div></div>

<p>Add to your <code class="language-plaintext highlighter-rouge">.bashrc</code> and reopen terminal. Typing <code class="language-plaintext highlighter-rouge">reset</code> won’t work</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' &gt;&gt; /home/$USER/.bashrc
cat ~/.bashrc # you should see above line
</code></pre></div></div>
<p>Now you can use <code class="language-plaintext highlighter-rouge">brew</code> every time you open terminal</p>

<p>If you use multiseat than you need to add new group and attach each user to it
https://apple.stackexchange.com/a/45003/449651
Error is</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew update &amp;&amp; brew upgrade ruby-build
Error: /home/linuxbrew/.linuxbrew/Homebrew is not writable. You should change the
ownership and permissions of /home/linuxbrew/.linuxbrew/Homebrew back to your
user account:
  sudo chown -R $(whoami) /home/linuxbrew/.linuxbrew/Homebrew
</code></pre></div></div>
<p>Add group</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo groupadd brew
compgen -u # list all users
sudo usermod -aG brew dule
sudo usermod -aG brew mile

sudo chgrp -R brew /home/linuxbrew/.linuxbrew/
sudo chmod -R g+w /home/linuxbrew/.linuxbrew/

# check that group has rw-
ls -la /home/linuxbrew/.linuxbrew/Homebrew/README.md
-rw-rw-r-- 1 dule brew 8495 феб  9 08:40 /home/linuxbrew/.linuxbrew/Homebrew/README.md

# also https://zenn.dev/megeton/articles/f9f17d184fead6
git config --global --add safe.directory /usr/local/Homebrew
</code></pre></div></div>

<h2 id="install-rbenv">
<a class="anchor" href="#install-rbenv" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install rbenv</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install rbenv ruby-build libyaml openssl@1.1
</code></pre></div></div>

<p>Add this to your <code class="language-plaintext highlighter-rouge">~/.bashrc</code> so you can access rbenv commands</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo export PATH="$HOME/.rbenv/bin:$PATH" &gt;&gt; ~/.bashrc
echo eval "$(rbenv init -)" &gt;&gt; ~/.bashrc
</code></pre></div></div>

<h2 id="installing-ruby-using-rbenv">
<a class="anchor" href="#installing-ruby-using-rbenv" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing Ruby using rbenv</h2>

<p>To change ruby version you can use <code class="language-plaintext highlighter-rouge">.ruby-version</code> file in current or any parent
folder. For example you can set default version with <code class="language-plaintext highlighter-rouge">.ruby-version</code> in your
home folder <code class="language-plaintext highlighter-rouge">~/</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 3.2.0 &gt; ~/.ruby-version
</code></pre></div></div>

<p>You can also change ruby version with this command or env variable</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rbenv shell 3.2.0

# this is the same as export RBENV_VERSION=3.2.0

# check all installed versions
rbenv versions
</code></pre></div></div>

<h3 id="ruby-320">
<a class="anchor" href="#ruby-320" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ruby 3.2.0</h3>

<p>For compiling Ruby 3.2.0 you should use openssl@3
Check <a href="https://github.com/rbenv/ruby-build/wiki">rbenv/ruby-build</a> wiki for
additional info</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install openssl@3

export RUBY_CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl@3`"

rbenv install 3.2.0
</code></pre></div></div>

<p>Export these variables, <strong>don’t</strong> save them in your <code class="language-plaintext highlighter-rouge">.bashrc</code> it won’t work for
every Ruby version so to be on the safe side just export them every time you
want to install new Ruby version</p>

<p>When you install gems that need to be compiled locally than you might need to
export PATH, LDFLAGS, CPPFLAGS or PKG_CONFIG_PATH</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH="/home/linuxbrew/.linuxbrew/opt/openssl@3/bin:$PATH"
export LDFLAGS="-L`brew --prefix openssl@3`/lib"
export CPPFLAGS="-I`brew --prefix openssl@3`/include"
export PKG_CONFIG_PATH="`brew --prefix openssl@3`/lib/pkgconfig"
</code></pre></div></div>

<p>Note: <strong>Do not restart terminal</strong> if you are exporting variables, it won’t persist in the next session</p>

<p>For example Installing Ruby version that uses openssl@1.1</p>

<p>To install version of ruby that uses openssl@1.1 we need to use RUBY_CONFIGURE_OPTS</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export RUBY_CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl@1.1`"
ruby install 2.6.7

export LDFLAGS="-L`brew --prefix openssl@1.1`/lib"
export CPPFLAGS="-I`brew --prefix openssl@1.1`/include"
export PKG_CONFIG_PATH="`brew --prefix openssl@1.1`/lib/pkgconfig"

bundle
</code></pre></div></div>

<p>For ruby 2.6.7 on mac for error</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm.c:2295:9: error: call to undeclared function 'rb_native_mutex_destroy'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
        rb_native_mutex_destroy(&amp;vm-&gt;waitpid_lock);
        ^
</code></pre></div></div>
<p>you might need</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CFLAGS="-Wno-error=implicit-function-declaration" rbenv install 2.6.7
</code></pre></div></div>

<p>For ruby 2.6.6 on mac you might see error</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error closure.c:264:14: error: call to undeclared function 'ffi_prep_closure'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
</code></pre></div></div>
<p>so you need to configure libffi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RUBY_CFLAGS=-DUSE_FFI_CLOSURE_ALLOC rbenv install 2.6.6
</code></pre></div></div>

<p>For Ruby 3.2.1 on ubuntu you might need to use define readline location</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export RUBY_CONFIGURE_OPTS="--with-openssl-dir=`brew --prefix openssl` --with-readline-dir=`brew --prefix readline`"
</code></pre></div></div>
<p>On macOS you, ruby 3.2.1 can be installed <code class="language-plaintext highlighter-rouge">rbenv install 3.2.1</code> but make sure
you are not using Rosseta (Finder &gt; Menu Go &gt; Utilities &gt; Terminal &gt; right click
Get Info &gt; uncheck Open using Rosetta) so the output is arm</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uname -m
arm64
</code></pre></div></div>

<h2 id="jekyll">
<a class="anchor" href="#jekyll" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jekyll</h2>

<p>When you install new gems, sometimes you need to rehash to create new shims
<a href="https://github.com/rbenv/rbenv#rbenv-rehash">https://github.com/rbenv/rbenv#rbenv-rehash</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem install jekyll
Command 'jekyll' not found, but can be installed with:

rbenv rehash
jekyll # now it works
</code></pre></div></div>

<h2 id="rails">
<a class="anchor" href="#rails" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rails</h2>

<p>If you notice an error when you are using <code class="language-plaintext highlighter-rouge">rails s</code> command</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadError: libssl.so.1.1: cannot open shared object file: No such file or directory - /home/dule/.rbenv/versions/3.2.0/lib/ruby/gems/3.2.0/gems/puma-5.6.5/lib/puma/puma_http11.so
</code></pre></div></div>
<p>you should remove puma gem and install with correct LD and CPP flags pointing to
openssl 3.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem uninstall puma

export LDFLAGS="-L$(brew --prefix openssl@3)/lib"
export CPPFLAGS="-I$(brew --prefix openssl@3)/include"

bundle

# or you can install specific version using arguments to `gem install`
gem install puma -v 5.6.5 -- --with-cppflags=-I`brew --prefix openssl@3`/include --with-ldflags=-L`brew --prefix openssl@3`/lib
</code></pre></div></div>

<p>Alternative solution is to disable SSL when installing puma</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem uninstall puma
DISABLE_SSL=1 bundle
</code></pre></div></div>

<h2 id="nvm-node-yarn">
<a class="anchor" href="#nvm-node-yarn" aria-hidden="true"><span class="octicon octicon-link"></span></a>NVM node yarn</h2>

<p>Install nvm <a href="https://github.com/nvm-sh/nvm">https://github.com/nvm-sh/nvm</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
</code></pre></div></div>
<p>than restart shell (ie open new shell) install node</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvm install 14
npm install -g yarn
</code></pre></div></div>

<p>Old node-sass has some issues with node 16 (it can not find python even python2
is installed)
<a href="https://stackoverflow.com/questions/67241196/error-no-template-named-remove-cv-t-in-namespace-std-did-you-mean-remove">stackoverflow</a></p>

<h2 id="wall">
<a class="anchor" href="#wall" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wall</h2>

<p>Enable tty group so user can send messages
<a href="https://unix.stackexchange.com/a/313558/150895">https://unix.stackexchange.com/a/313558/150895</a></p>

<h2 id="python">
<a class="anchor" href="#python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python</h2>

<p>You can install python using pyenv https://github.com/pyenv/pyenv similar to
rbenv</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install pyenv
pyenv install 2.7.18
# pyenv global 2.7.18
pyenv shell 2.7.18
pyenv versions

# Add to .bashrc
# PATH=$(pyenv root)/shims:$PATH
# eval "$(pyenv init -)"
</code></pre></div></div>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:salji@trk.in.rs">salji@trk.in.rs</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>TRK RUBY NOVI SAD
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
