<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Ubuntu Multiseat</title>
  <meta name="description" content="You can easilly start with multiseat. Here is a nice bloghttps://www.apalrd.net/posts/2022/multiseat_intro/You can use this script to get all statusessudo lo...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://dev.trk.in.rs/2023/01/05/ubuntu-multiseat/">
  <link rel="alternate" type="application/rss+xml" title="TRK RAILS" href="https://dev.trk.in.rs/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">
      <img src="/assets/rails_trk.svg" class="header-logo">
      TRK RAILS
    </a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Ubuntu Multiseat</h1>
    <p class="post-meta"><time datetime="2023-01-05T00:00:00+00:00" itemprop="datePublished">Jan 5, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#steps">Steps</a></li>
<li class="toc-entry toc-h2"><a href="#issues">Issues</a></li>
<li class="toc-entry toc-h1"><a href="#usb-dock">USB Dock</a></li>
</ul><p>You can easilly start with multiseat. Here is a nice blog
<a href="https://www.apalrd.net/posts/2022/multiseat_intro/">https://www.apalrd.net/posts/2022/multiseat_intro/</a>
You can use this script to get all statuses
sudo loginctl seat-status seat3 &gt; ~/config/loginctl/seat3.seat-status.txt</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ~/config/loginctl_seats/seat_statuses.sh
set -x # Show command being executed              

sudo loginctl seat-status seat0 &gt; ~/config/loginstl_seats/seat0.seat-status.txt
sudo loginctl seat-status seat1 &gt; ~/config/loginstl_seats/seat1.seat-status.txt
sudo loginctl seat-status seat2 &gt; ~/config/loginstl_seats/seat2.seat-status.txt
sudo loginctl seat-status seat3 &gt; ~/config/loginstl_seats/seat3.seat-status.txt                                                                                       
</code></pre></div></div>
<p>Before setting the seats you can read some info about command</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man loginctl
loginctl list-seats
# when you want to remove all seats and attach to default
loginctl flush-devices
</code></pre></div></div>

<p>Let’s store configuration in tmp folder which is tracked with git, for example</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir ~/config/loginctl_seats
cd ~/config/loginctl_seats
git init .
</code></pre></div></div>

<h2 id="steps">
<a class="anchor" href="#steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Steps</h2>

<p>Lets generate info</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./seat_statuses.sh
git add .
git diff --staged
</code></pre></div></div>
<p>here is example seat status</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lspci | grep VGA
03:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750/8740 / R7 250E]
04:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750/8740 / R7 250E]

radeontop -b 03
# Graphic pipe 10,00%
# this should remain in seat0 which will be default
radeontop -b 04
# Graphic pipe 0,00%

</code></pre></div></div>

<p>You need to attach MASTER devices (ie graphic cards) otherwise new seat will not
be created.
Search for <code class="language-plaintext highlighter-rouge">drm</code> and look at last number (in this case <code class="language-plaintext highlighter-rouge">04</code>)
Also need to attach <code class="language-plaintext highlighter-rouge">render</code> and <code class="language-plaintext highlighter-rouge">fb</code> (frame buffer, if exists) and sound Also
find the ports that you want to assign. If you have usb dock station than you do
have to allocate only one port. All devices attached to docking station will be
under that port (also the soud and microphone). You can use headset with
microphone and with one 3.5mm cable you have stable sound connection.
Put that in <code class="language-plaintext highlighter-rouge">attach_seats.sh</code> file so we can modify and run easilly</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># attach_seats.sh
sudo loginctl attach seat1 /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:10.0/0000:04:00.0/drm/card1
sudo loginctl attach seat1 /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:10.0/0000:04:00.0/drm/renderD129
sudo loginctl attach seat1 /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:10.0/0000:04:00.0/graphics/fb1

sudo loginctl attach seat1 /sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:10.0/0000:04:00.1/sound/card2

# those usb porst are two first rows on the back
sudo loginctl attach seat1 /sys/devices/pci0000:00/0000:00:1d.0/usb2
</code></pre></div></div>

<p>When you run attach you should not see any 04 devices on seat0</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./attach_seats.sh

# restart
./seat_statuses.sh &amp;&amp; git diff
git add .
</code></pre></div></div>

<h2 id="issues">
<a class="anchor" href="#issues" aria-hidden="true"><span class="octicon octicon-link"></span></a>Issues</h2>

<p>When someone logs out than all users will log out and only seat0 will get
login screen. Sometimes it helps that seat0 log in and log out. The best is to use Lock instead of Log out.</p>

<p>When you remove graphic card, than that seat will be discarded and all it’s
devices will be assigned to default seat seat0.</p>

<p>To remove one specific device from seat, you need to attach to another seat (you
need to know it’s path)</p>

<h1 id="usb-dock">
<a class="anchor" href="#usb-dock" aria-hidden="true"><span class="octicon octicon-link"></span></a>USB Dock</h1>

<p>Download Display Link software from <a href="https://www.synaptics.com/products/displaylink-graphics/downloads/ubuntu">https://www.synaptics.com/products/displaylink-graphics/downloads/ubuntu</a>
and follow <a href="https://support.displaylink.com/knowledgebase/articles/1944022-how-to-install-displaylink-software-on-ubuntu-20-0">https://support.displaylink.com/knowledgebase/articles/1944022-how-to-install-displaylink-software-on-ubuntu-20-0</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ./displaylink-driver-5.3.0.xx.run
# this will install libdrm-dev lipciaccess-dev

Installing
[ Installing EVDI ]
[[ Installing EVDI DKMS module ]]
Creating symlink /var/lib/dkms/evdi/1.12.0/source -&gt; /usr/src/evdi-1.12.0

Kernel preparation unnecessary for this kernel. Skipping...

Building module:
cleaning build area...
make -j24 KERNELRELEASE=5.19.0-35-generic all INCLUDEDIR=/lib/modules/5.19.0-35-generic/build/include KVERSION=5.19.0-35-generic DKMS_BUILD=1...
Signing module:
 - /var/lib/dkms/evdi/1.12.0/5.19.0-35-generic/x86_64/module/evdi.ko
EFI variables are not supported on this system
/sys/firmware/efi/efivars not found, aborting.
cleaning build area...

evdi.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/5.19.0-35-generic/updates/dkms/

depmod....
[[ Installing module configuration files ]]
[[ Installing EVDI library ]]
make: Entering directory '/tmp/tmp.XS3WN4Qt0Q/evdi/library'
cc -I../module -std=gnu99 -fPIC -D_FILE_OFFSET_BITS=64    -c -o evdi_lib.o evdi_lib.c
cc evdi_lib.o -shared -Wl,-soname,libevdi.so.0 -o libevdi.so.1.12.0 -lc -lgcc 
cp libevdi.so.1.12.0 libevdi.so
make: Leaving directory '/tmp/tmp.XS3WN4Qt0Q/evdi/library'
[ Installing x64-ubuntu-1604/DisplayLinkManager ]
[ Installing libraries ]
[ Installing firmware packages ]
[ Installing licence file ]
[ Adding udev rule for DisplayLink DL-3xxx/4xxx/5xxx/6xxx devices ]
[ Adding upstart and powermanager sctripts ]

Please read the FAQ
http://support.displaylink.com/knowledgebase/topics/103927-troubleshooting-ubuntu

Installation complete!

Please reboot your computer if you're intending to use Xorg.
</code></pre></div></div>

<p>Read FAQ
https://support.displaylink.com/knowledgebase/topics/103927-troubleshooting-ubuntu</p>

<p>When you move the between seats only difference is that it moves sound:card and
usb (all attached usb devices will show up under this usb device)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		  │   │ ├─/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2/1-1.2.2
		  │   │ │ usb:1-1.2.2
		  │   │ │ ├─/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2/1-1.2.2/1-1.2.2.1/1-1.2.2.1:1.2/sound/card6
		  │   │ │ │ sound:card6 "Dock"
		  │   │ │ └─/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2/1-1.2.2/1-1.2.2.4
		  │   │ │   usb:1-1.2.2.4
</code></pre></div></div>
<p>other devices stays the same.
And there is no change when we start or stop the driver.</p>

<p>Driver page is <a href="https://github.com/DisplayLink/evdi">https://github.com/DisplayLink/evdi</a></p>

<p>You can stop start the driver with</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service displaylink-driver stop
</code></pre></div></div>

<p>You can attach specific evdi drm to new seats <a href="https://askubuntu.com/a/1304701/40031">https://askubuntu.com/a/1304701/40031</a></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:salji@trk.in.rs">salji@trk.in.rs</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>TRK RUBY NOVI SAD
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
