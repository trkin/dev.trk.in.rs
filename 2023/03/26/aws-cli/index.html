<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Aws Cli</title>
  <meta name="description" content="Install and configure AWS cli">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://dev.trk.in.rs/2023/03/26/aws-cli/">
  <link rel="alternate" type="application/rss+xml" title="DEV TRK" href="https://dev.trk.in.rs/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">
      <img src="/assets/trk_turbo_ruby_kode_lines.png" class="header-logo">
      TRK RAILS
    </a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Aws Cli</h1>
    <p class="post-meta"><time datetime="2023-03-26T00:00:00+00:00" itemprop="datePublished">Mar 26, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#install-and-configure-aws-cli">Install and configure AWS cli</a></li>
</ul><h1 id="install-and-configure-aws-cli">
<a class="anchor" href="#install-and-configure-aws-cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install and configure AWS cli</h1>

<p>Install and enable completion</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Ubuntu
sudo apt install awscli

# .bash_profile should source .bashrc
echo complete -C '/usr/local/bin/aws_completer' aws &gt; ~/.bashrc
</code></pre></div></div>

<p>You need keys to connect and configure will store them in <code class="language-plaintext highlighter-rouge">~/.aws/credentials</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure
AWS Access Key ID [None]: 123....4P5Q
AWS Secret Access Key [None]: 123...TCzr
Default region name [None]: us-east-1
Default output format [None]:

cat ~/.aws/credentials
[default]
aws_access_key_id = 123...4P5Q
aws_secret_access_key = 123...TCzr

cat ~/.aws/config
[default]
region = us-east-1

aws configure
AWS Access Key ID [**************4P5Q]:
AWS Secret Access Key [****************TCzr]:
</code></pre></div></div>
<p>You can have several profiles in additional to <code class="language-plaintext highlighter-rouge">[default]</code>.
To add another profile</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure --profile duleorlovic
# this will add [profile duleorlovic] to ~/.aws/config
# and [duleorlovic] to ~/.aws/credentials
# you can use in terraform provider "aws" { profile = "duleorlovic" }
aws ec2 describe-vpcs --profile duleorlovic
</code></pre></div></div>
<p>You can check which profile you are using</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># show current profile settings
aws configure list

# list all profile names
aws configure list-profile
</code></pre></div></div>
<p>To change profile in shell you can export</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export AWS_PROFILE=duleorlovic
</code></pre></div></div>
<p>Another way to change profile is to use different credentials file</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AWS_SHARED_CREDENTIALS_FILE=~/.aws/credentials_duleorlovic aws s3 ls s3://my-trk-bucket
</code></pre></div></div>

<p>You can extract data with query to parse json for example
Find other examples on <code class="language-plaintext highlighter-rouge">aws ec2 describe-instances help</code>
TODO: add examples</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">[*]</code> array</li>
  <li>
<code class="language-plaintext highlighter-rouge">.attribute</code>
you can have <code class="language-plaintext highlighter-rouge">--output text</code>, <code class="language-plaintext highlighter-rouge">--output json</code> or <code class="language-plaintext highlighter-rouge">--output table</code>, or you can
use <code class="language-plaintext highlighter-rouge">jq</code>
</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># list all public instances, using * returns array of arrays
aws ec2 describe-instances --query "Reservations[*].Instances[*].PublicIpAddress" --output=text
# this returns inline results since it is single array
aws ec2 describe-instances --query "Reservations[].Instances[].PublicIpAddress" --output=text
</code></pre></div></div>
<p>You can combine columns, for example to show ARN</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 describe-instances --region us-east-1 | jq -r '.Reservations[] | .OwnerId as $OwnerId | ( .Instances[] | { "ARN": "arn:aws:ec2:\(.Placement.AvailabilityZone[:-1]):\($OwnerId):instance/\(.InstanceId)", "AvailabilityZone": "\(.Placement.AvailabilityZone)", InstanceId, PublicDnsName, PrivateDnsName, Tags} )' | jq -s .
[
  {
    "ARN": "arn:aws:ec2:us-east-1:606470370249:instance/i-0b7175eed059b8f41",
    "AvailabilityZone": "us-east-1a",
    "InstanceId": "i-0b7175eed059b8f41",
    "PublicDnsName": "ec2-34-230-46-141.compute-1.amazonaws.com",
    "PrivateDnsName": "ip-172-31-90-19.ec2.internal",
    "Tags": [
      {
        "Key": "Name",
        "Value": "test"
      }
    ]
  }
]
</code></pre></div></div>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:salji@trk.in.rs">salji@trk.in.rs</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>TRK RUBY NOVI SAD
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
